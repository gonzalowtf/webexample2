<!doctype html>
<html lang="en" ng-app ="MainApp">
<head>
    <meta charset="UTF-8">
    <title>WebExample-Chat</title>
    <meta http-equiv ="web store example">
    <meta http-equiv ="Content-Type" content ="text/html";>

	<script src ="https://code.jquery.com/jquery.js"></script>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
   
    <script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
 
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.10/angular-ui-router.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-route.min.js"></script>
    <script type="text/javascript" src = "bootbox.min.js"></script>
    <script type="text/javascript" src = "scriptchat.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src ="http://code.jquery.com/jquery-latest.min.js"></script>

    
    <style type="text/css">
      
       @font-face{
          font-family: "caitlin";
          src: url("Caitlin.ttf") format("truetype");
    }
      
      .header{
        font-family : caitlin;
        color: white;
        font-size: 90px;
    }
    .container{
    
     
     width:18%;
     position: absolute;
     top: 40%;
     
     float: left;
     	
    }
    .container2{
      height:40%;
      width:40%;
      position: absolute;
      left:18%;
      top: 40%;
      	
    }
    .divider2{
      position: absolute;
      top:10%;
      color : white;
    }
    .container3{
      height:40%;
      width:40%;
      position: absolute;
      left: 60%;
      top: 40%;

    }
    .message{
      position: absolute;
      left:5%;
      top: 30%;
      width : 25%;
    }
    .visitor{
       
       float:right;


    }
    
    </style>

</head>
<body background ="fondon.jpg">  
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a id="home" class="navbar-brand" href="https://webexample-c9-gonzalowtf77.c9.io/webexample2/index.html">Home</a>
    </div>    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a id="conta" href="contact.html">Contact Us</a></li>
        <li><a id="reg" href="register.html">Register</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Actions <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a id= "stor" href="store.html">Store</a></li>
            <li><a id="chat" href="chat.html">Chat Room</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search on the go...">
        </div>
        <button type="submit" class="btn btn-default">Go !</button>
      </form>
      <ul class="nav navbar-nav navbar-right">
        <li><a id="loged" href="#" onClick="log()"><span id="id">Log In</span></a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Found Us<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#" onClick="facebook()">Facebook</a></li>
            <li><a href="#" onClick="twitter()">Twitter</a></li>
            <li><a href="#" onClick ="google()">Google +</a></li>
            <li class="divider"></li>
            <li><a href="#" onClick="prog()">With The Programmer</a></li>
          </ul>
        </li>
      </ul>
    </div>
   </div> 

</nav>
<center><div class="header">
    
    Chat Room
    
</div></center>
<hr class="divider2"></hr></br></br>
<div class="message">
<form id ="sendmessage" class ="input-group" style ="text-align:center; margin:0 auto;">
            	


<span class ="input-group-btn">
<input id ="mes" class = "form-control input-lg" type ="text" placeholder = "message...."></input>

<button class ="btn btn-lg btn-primary" type ="submit">



Send
</button>


</span>


</form>
</div>
</br></br>
<div class="container">
  <div class="panel panel-primary" id ="panel">
    <div class="panel-heading">
      <h3 class="panel-title">Users online</h3>
    </div>
  <div id="nick" class="panel-body">
   
  </div>
</div>

</div>
<div class="container2">
  <div class="panel panel-success" id ="panel2">
     <div class="panel-heading">
      <h3 class="panel-title">Individual chat</h3>
    </div>
  <div id= "message" class="panel-body">
    
  </div>
</div>
</div>
<div class="container3">
<div class="panel panel-warning">
  <div class="panel-heading">
      <h3 class="panel-title">General chat</h3>
    </div>
  <div id= message2 class="panel-body">
    
  </div>
  </div>
</div>  

<script type="text/javascript">
   
  /*function t(vari,socket){
    
     var messageForm = document.getElementById('sendmessage');
     var theM = document.getElementById('mes');
     var users=document.getElementById('nick');
     var chatIndividual =document.getElementById('message');
     var chatGeneral =document.getElementById('message2');
     var bot =document.getElementById('bot');
     console.log("llego"); 
    
    socket.emit("new-user",vari.val,function(data){
          if(data){
                  
                  console.log("usuarios conectados");
              }
          else{
                     bootbox.alert("You are not logged in or we have a problem with the connection , try it again later");
                }



            
            console.log("llegoo");


     });
  
  
  
  socket.on("usernames", function(data){
            var html ="";
            var i;
            for(i=0; i<data.length;i++){
                html += data[i] + '</br>';
            }
            users.innerHTML=html;
     });
     
     

   socket.on('new-message',function(data){
              chatGeneral.innerHTML = chatGeneral.innerHTML+'</br>'+data.nick + ":" +data.msg +"<br>";
            })
            
          



   }

     
     
     function button1(socket){




                console.log(theM.value);
                socket.emit("send-message",theM.value);
                theM.value ='';




     }


     
*/
      

       
      

  function color(){ 
   var hexadecimal = new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"); 
   var color_aleatorio = "#"; 
   var posarray=0;
   
   for (i=0;i<6;i++){ 
      posarray = aleatorio(0,hexadecimal.length); 
      color_aleatorio += hexadecimal[posarray]; 
   } 
   return color_aleatorio; 
}
function aleatorio(inferior,superior){ 
  var numPosibilidades = superior - inferior; 
   var aleat = Math.random() * numPosibilidades; 
   aleat = Math.floor(aleat); 
   return parseInt(inferior) + aleat; 
}


  
     
  
</script>

<script type="text/javascript" >
 function getVar(){
      
      var url = location.search.replace("?",",");
      var arr=url.split("&");
      var obj = {};
      for (var i =0; i<arr.length;i++){
        var x = arr[i].split("=");
        obj[x[0]]=x[1];
      }
      return obj;
      
    }
          var vari =getVar();
         // var socket = io.connect();     

          console.log(vari.val);
    if(vari.val ===null || vari.val==="" || vari.val === undefined){
    console.log(vari.val+" variable does not exits!");
     }
     else{
       console.log("variable exist!");
       
       //t(vari);
                         }  

             var c= color();    



jQuery(function($){

             var socket = io.connect(); 
             var $vari =getVar();
             var $messageForm = $('#sendmessage');
             var $theM = $('#mes');
             var $users=$('#nick');
             var $chatIndividual =$('#message');
             var $chatGeneral =$('#message2');
             console.log("llego");
             var arrayColours=[];
             var us=[];
    
            arrayColours[0]=c;
            us[0]=vari.val; 

             socket.emit("new-user",vari.val,function(data){
          if(data){
                  

                  console.log("usuarios conectados");
              }
          else{
                              console.log("error de coneccion");

                     
                }



            
            console.log("llegoo");


     }); 
        

        socket.on("usernames", function(data){
            var html ="";
            var con=0;
            for(i=0; i<data.length;i++){
                for(j=0;j<us.length;j++){
                  if(data[i]!=us[j]){
                    con++;
                }else{
                      break;
                }
                if(con==us.length){
                    us[con+1]=data[i];
                    c=color();
                    console.log(c);

                    arrayColours[con+1]=c;
                    break;

                }
                }
                console.log(us);
                console.log(arrayColours);
                
                              

                  }


                  for(k=0;k<data.length;k++){

                        for(z=0;z<us.length;z++){

                         if(data[k]==us[z]){
                           
                            html += '<i style="color:'+arrayColours[z]+'">'+data[k] + '</i></br>';
                            console.log(html);
                            $users.html(html);
                            break;



                         }







                        }




                  }

          });




        $messageForm.submit(function(e){

      e.preventDefault();
      socket.emit('send-message',$theM.val());
    $theM.val('');
           });

      socket.on('new-message',function(data){
        
        if(data.nick===vari.val){
        $chatGeneral.append('<br><i style="color:'+arrayColours[0]+'">'+data.nick + "</i>:" +data.msg +"<br>");
          console.log("print local");
      }else{
        
                for(i=0;i<us.length;i++){
                  if(data.nick==us[i]){

            $chatGeneral.append('<br><span class = "visitor"><i style="color:'+arrayColours[i]+'">'+data.nick + "</i>:" +data.msg +"<br></span>");

                  console.log("print visitor");






                  }
                }

        

      }

      
      });


        });


   
</script>

<script type="text/javascript">
    
    
  function facebook(){
    bootbox.alert("Link to the Facebook´s page"); 
  }
  function twitter(){
    bootbox.alert("Link to the Twitter´s page"); 
  }
  function google(){
    bootbox.alert("Link to the Google+´s page"); 
  }
  function prog(){
    bootbox.alert("Link to the Programmer´s  page"); 
  }

  </script>
  
    <script type="text/javascript" src="scriptchat.js"></script>

</body>    
</html>    